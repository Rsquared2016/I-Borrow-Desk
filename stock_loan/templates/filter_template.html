{% extends 'base.html' %}

{% block content %}

<script>
    $(document).ready(function()
    {
        $("#stocks").tablesorter({
                    headers: {
                        4: {
                            sorter:'thousands'
                        }
                    }
                }
        );
    });

// add parser through the tablesorter addParser method
$.tablesorter.addParser({
    // set a unique id
    id: 'thousands',
    is: function(s) {
        // return false so this parser is not auto detected
        return false;
    },
    format: function(s) {
        // format your data for normalization
        return s.replace('$','').replace(/,/g,'');
    },
    // set type, either numeric or text
    type: 'numeric'
});

</script>

    <div class= "col-md-12">

        {% from "_formhelpers.html" import render_field %}

        <h2>Database Search</h2>
        <form action="{{ url_for('filter_db') }}" method=post class="form-group">
            {{ form.hidden_tag() }}
            <div class="row">
                <div class="col-md-4">
                    {{ form.min_available(class='form-control') }} {{ form.min_available.description }}
                </div>
                <div class="col-md-4">
                    {{ form.max_available(class='form-control') }} {{ form.max_available.description }}
                </div>
                <div class="col-md-4">
                     {{ render_field(form.country) }}
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-4">
                    {{ form.min_fee(class='form-control') }} {{ form.min_fee.description }}
                </div>
                <div class="col-md-4">
                    {{ form.max_fee(class='form-control') }} {{ form.max_fee.description }}
                </div>
                <div class="col-md-4">
                    {{ render_field(form.order_by) }}
                </div>
            </div>
            <br>

            <div class="row">
                <div class="col-md-12">
                    <div class="control-group">
                        <div class="controls">
                          <button type="submit" class="btn btn-primary">Submit</button> Maximum 100 results returned
                        </div>
                    </div>
                </div>


            </div>

        </form>

         <table class="tablesorter table table-condensed table-responsive table-hover" id="stocks">
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Name</th>
                    <th>Fee</th>
                    <th>Availability</th>
                    <th>Last Updated (EST)</th>
                </tr>
            </thead>
            <tbody data-link="row" class="rowlink">
                {% for symbol in summary %}
                    <tr>
                        <td>
                        <a href="{{url_for('historical_report')}}?symbol={{symbol['symbol']}}&&real_time=False">
                            {{symbol['symbol']}}</a></td>
                        <td>{{ symbol['name'] }}</td>
                        <td>{{ '{:.1%}'.format(symbol['fee']/100) }}</td>
                        <td>{{ '{:,}'.format(symbol['available']) }}</td>
                        <td>{{symbol['datetime']}}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>

{% endblock %}
