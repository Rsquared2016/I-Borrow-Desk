{% extends 'base.html' %}

{% block content %}
    {% from "_formhelpers.html" import render_field %}

<script>
    $(document).ready(function()
    {
        $("#stocks").tablesorter({
                    headers: {
                        4: {
                            sorter:'thousands'
                        },
                        6: {
                            sorter: false
                        }

                    }
                }
        );
    });

// add parser through the tablesorter addParser method
$.tablesorter.addParser({
    // set a unique id
    id: 'thousands',
    is: function(s) {
        // return false so this parser is not auto detected
        return false;
    },
    format: function(s) {
        // format your data for normalization
        return s.replace('$','').replace(/,/g,'');
    },
    // set type, either numeric or text
    type: 'numeric'
});

</script>


    <div class= "col-md-12">
        <h2>Watchlist</h2>

        <form class="form-inline"  role="form" action= "" method = 'POST'>
            <div class="form-group">
                <label class="control-label" for="symbols">Add:</label>
                <input class = "form-control" type = 'text' id = 'symbols' name = 'symbols' placeholder = 'BAC, IBM' value=''>
                <label class="control-label" for="remove-symbols">Remove:</label>
                <input class = "form-control" type = 'text' id = 'remove-symbols' name = 'remove-symbols' placeholder = 'BAC, IBM' value=''>
                <button type='submit' class="btn btn-primary">Submit</button>
            </div>
        </form>
        <br><br>
        {% if current_user.receive_email == True %}
            You are receiving a morning email.<br>
            <a href="{{ url_for('change_morning_email') }}?receive=False">Click here if you'd like to stop receiving these emails</a>
        {% else %}
            Not receiving a morning email at the moment.<br>
            <a href="{{ url_for('change_morning_email') }}?receive=True">Click here if you'd like to start receiving these emails</a>
        {% endif %}

    <hr>
         <table class="tablesorter table table-condensed table-responsive table-hover" id="stocks">
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Name</th>
                    <th>Fee</th>
                    <th>Availability</th>
                    <th>Timestamp (EST) </th>
                    <th>Remove</th>
                </tr>
            </thead>
            <tbody data-link="row" class="rowlink">
                {% if summary %}
                    {% for symbol in summary %}
                        <tr>
                            <td>
                            <a href="{{url_for('historical_report')}}?symbol={{symbol['symbol']}}&&real_time=True"> {{symbol['symbol']}}</a></td>
                           <td>{{ symbol['name'] }}</td>
                            <td>{{ '{:.1%}'.format(symbol['fee']/100) }}</td>
                            <td>{{ '{:,}'.format(symbol['available']) }}</td>
                            <td>{{symbol['datetime']}}</td>
                                <td>
                                    <form action="{{ url_for('remove_from_watchlist', symbol=symbol['symbol']) }}">
                                        <input type="submit" value="Remove" class="btn btn-danger btn-xs"/>
                                    </form>
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>


    </div>

{% endblock %}
